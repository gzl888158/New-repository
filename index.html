<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>OKX合约交易辅助工具</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        /* 欧易同源深色主题 */
        body { background: #121212; color: #fff; margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        .container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .chart-box { height: 400px; border: 1px solid #333; border-radius: 8px; padding: 10px; }
        .shortcut { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); color: #ccc; }
    </style>
</head>
<body>
    <h1>欧易合约交易监控（15m-4h短线聚焦）</h1>
    <div class="container">
        <div class="chart-box" id="btc-chart">BTC-USDT-SWAP（15m）</div>
        <div class="chart-box" id="eth-chart">ETH-USDT-SWAP（15m）</div>
        <div class="chart-box" id="sol-chart">SOL-USDT-SWAP（15m）</div>
        <div class="chart-box" id="bnb-chart">BNB-USDT-SWAP（1h）</div>
        <div class="chart-box" id="ada-chart">ADA-USDT-SWAP（1h）</div>
        <div class="chart-box" id="depth-chart">深度图（BTC-USDT）</div>
    </div>
    <div class="shortcut">
        快捷键：F1切换K线周期 | F2启动止盈止损 | F3保证金计算器 | F4叠加指标
    </div>

    <script>
        // WebSocket连接欧易公共行情（延迟≤100ms）
        const ws = new WebSocket("wss://ws.okx.com:8443/ws/v5/public");
        ws.onopen = () => {
            ws.send(JSON.stringify({
                op: "subscribe",
                args: [
                    { channel: "candle15m", instId: "BTC-USDT-SWAP" },
                    { channel: "candle15m", instId: "ETH-USDT-SWAP" },
                    { channel: "depth5", instId: "BTC-USDT-SWAP" }
                ]
            }));
        };

        // 初始化K线图（裸K+形态标注）
        function initChart(id) {
            const chart = echarts.init(document.getElementById(id));
            chart.setOption({
                backgroundColor: "#121212",
                xAxis: { type: "category", boundaryGap: false, axisLine: { lineStyle: { color: "#333" } } },
                yAxis: { type: "value", axisLine: { lineStyle: { color: "#333" } } },
                series: [{ type: "candlestick", data: [], itemStyle: { color: "#f00", color0: "#0f0" } }]
            });
            return chart;
        }

        const btcChart = initChart("btc-chart");
        const depthChart = initChart("depth-chart");

        // 接收行情数据并更新图表
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            if (data.arg?.channel === "candle15m") {
                const candle = data.data[0];
                btcChart.setOption({
                    series: [{ data: [[candle[0], candle[1], candle[2], candle[3], candle[4]]] }]
                });
            }
            if (data.arg?.channel === "depth5") {
                // 深度图前5档数据
                const asks = data.data[0].asks.map(d => [d[0], d[1]]);
                const bids = data.data[0].bids.map(d => [d[0], d[1]]);
                depthChart.setOption({
                    series: [{ type: "bar", data: asks, name: "卖盘" }, { type: "bar", data: bids, name: "买盘" }]
                });
            }
        };

        // 快捷键绑定
        document.addEventListener("keydown", (e) => {
            if (e.key === "F1") alert("切换K线周期：15m → 1h → 4h");
            if (e.key === "F2") alert("启动止盈止损策略，请在Python端确认参数");
        });
    </script>
</body>
</html>