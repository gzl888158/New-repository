<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>欧易合约监控工具</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <style>
        body { background: #121212; color: #fff; margin: 0; padding: 20px; font-family: Arial; }
        .chart-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 20px; }
        .chart-box { height: 400px; border: 1px solid #333; border-radius: 8px; padding: 10px; }
        .shortcut { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); color: #ccc; }
    </style>
</head>
<body>
    <h1>欧易合约实时监控（15m-4h 短线）</h1>
    <div class="chart-grid">
        <div class="chart-box" id="btc-chart">BTC-USDT-SWAP（15m K线）</div>
        <div class="chart-box" id="depth-chart">BTC 深度图（前5档）</div>
    </div>
    <div class="shortcut">快捷键：F1切换周期 | F2启动策略 | F3风险监控</div>

    <script>
        // 连接欧易 WebSocket 公共行情
        const ws = new WebSocket("wss://ws.okx.com:8443/ws/v5/public");
        ws.onopen = () => {
            ws.send(JSON.stringify({
                op: "subscribe",
                args: [
                    { channel: "candle15m", instId: "BTC-USDT-SWAP" },
                    { channel: "depth5", instId: "BTC-USDT-SWAP" }
                ]
            }));
        };

        // 初始化 ECharts 图表
        const btcChart = echarts.init(document.getElementById("btc-chart"), null, { renderer: 'canvas' });
        const depthChart = echarts.init(document.getElementById("depth-chart"), null, { renderer: 'canvas' });

        btcChart.setOption({
            backgroundColor: "#121212",
            xAxis: { type: "category", axisLine: { color: "#333" } },
            yAxis: { type: "value", axisLine: { color: "#333" } },
            series: [{ type: "candlestick", data: [], itemStyle: { color: "#ff4d4f", color0: "#52c41a" } }]
        });

        depthChart.setOption({
            backgroundColor: "#121212",
            xAxis: { type: "value", axisLine: { color: "#333" } },
            yAxis: { type: "category", axisLine: { color: "#333" } },
            series: [
                { name: "卖盘", type: "bar", data: [], itemStyle: { color: "#ff4d4f" } },
                { name: "买盘", type: "bar", data: [], itemStyle: { color: "#52c41a" } }
            ]
        });

        // 接收行情数据并更新图表
        ws.onmessage = (e) => {
            const data = JSON.parse(e.data);
            // 更新 K 线
            if (data.arg?.channel === "candle15m") {
                const [ts, open, high, low, close] = data.data[0];
                btcChart.setOption({
                    xAxis: { data: [new Date(parseInt(ts)).toLocaleTimeString()] },
                    series: [{ data: [[open, close, low, high]] }]
                });
            }
            // 更新深度图
            if (data.arg?.channel === "depth5") {
                const asks = data.data[0].asks.map(d => [d[1], d[0]]).reverse();
                const bids = data.data[0].bids.map(d => [d[1], d[0]]);
                depthChart.setOption({
                    series: [{ data: asks }, { data: bids }]
                });
            }
        };

        // 快捷键绑定
        document.addEventListener("keydown", (e) => {
            if (e.key === "F1") alert("切换 K 线周期：15m → 1h → 4h");
            if (e.key === "F2") alert("策略已启动，请查看 GitHub Actions 日志");
            if (e.key === "F3") alert("保证金风险监控中...");
        });
    </script>
</body>
</html>