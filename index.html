<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æ¬§æ˜“åˆçº¦äº¤æ˜“åŠ©æ‰‹ | å…è´¹è¡Œæƒ…ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif;
        }
        body {
            background: #0f172a;
            color: #f8fafc;
            padding: 15px;
            line-height: 1.6;
        }
        .header {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            color: #38bdf8;
            margin-bottom: 20px;
            text-shadow: 0 0 8px rgba(56, 189, 248, 0.5);
        }
        /* æ¨¡å¼åˆ‡æ¢åŒº */
        .mode-switch {
            background: #1e293b;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            text-align: center;
            border: 2px solid #f59e0b;
        }
        .mode-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            margin: 0 5px;
            font-weight: bold;
            cursor: pointer;
        }
        .mock-mode { background: #f59e0b; color: #fff; }
        .real-mode { background: #10b981; color: #fff; }
        .mode-tips { font-size: 12px; margin-top: 8px; color: #94a3b8; }
        /* ä½¿ç”¨æŒ‡å—æ¨¡å— */
        .guide-module {
            background: #1e293b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border: 2px solid #38bdf8;
        }
        .guide-title {
            font-size: 16px;
            font-weight: bold;
            color: #38bdf8;
            margin-bottom: 10px;
            text-align: center;
        }
        .guide-step {
            background: #27374d;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 8px;
        }
        .guide-step-title {
            font-weight: bold;
            color: #f59e0b;
            margin-bottom: 5px;
        }
        .guide-step-content {
            font-size: 13px;
            line-height: 1.5;
        }
        .guide-highlight {
            color: #10b981;
            font-weight: bold;
        }
        /* çŠ¶æ€æ -é¢œè‰²åˆ†çº§é¢„è­¦ */
        .status-bar {
            background: #1e293b;
            border-radius: 10px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 13px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .status-item {
            padding: 4px 8px;
            border-radius: 4px;
        }
        .status-safe { background: #10b981; color: #fff; }
        .status-warning { background: #f59e0b; color: #fff; }
        .status-danger { background: #ef4444; color: #fff; }
        .status-neutral { background: #64748b; color: #fff; }
        /* å¸ç§è¡Œæƒ…çœ‹æ¿ */
        .coin-dashboard {
            background: #1e293b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            overflow-x: auto;
        }
        .dashboard-title {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #94a3b8;
        }
        .coin-card {
            display: inline-block;
            width: 120px;
            background: #27374d;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            margin-right: 10px;
            cursor: pointer;
        }
        .coin-card.active {
            border: 2px solid #38bdf8;
            box-shadow: 0 0 10px rgba(56, 189, 248, 0.5);
        }
        .coin-name { font-size: 16px; font-weight: bold; }
        .coin-price { font-size: 14px; margin: 5px 0; }
        .coin-change { font-size: 12px; }
        .rise { color: #ef4444; }
        .fall { color: #10b981; }
        /* æ ¸å¿ƒåŠŸèƒ½åŒº-å‚»ç“œå¼æŒ‰é’® */
        .func-area {
            background: #1e293b;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .area-title {
            font-size: 15px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #94a3b8;
        }
        .btn-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .big-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            touch-action: manipulation;
        }
        .primary-btn { background: #38bdf8; color: #fff; }
        .risk-btn { background: #ef4444; color: #fff; }
        .normal-btn { background: #64748b; color: #fff; }
        /* é£æ§è®¡ç®—å™¨-è‡ªåŠ¨è®¡ç®—+é˜²å‘†æç¤º */
        .risk-calc {
            background: #27374d;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }
        .calc-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #475569;
            border-radius: 4px;
            background: #1e293b;
            color: #fff;
            font-size: 13px;
        }
        .calc-result {
            font-size: 13px;
            margin-top: 10px;
            padding: 8px;
            border-radius: 4px;
            background: #0f172a;
        }
        /* è‡ªåŠ¨å§”æ‰˜æ¨¡å—-æ ¸å¿ƒ */
        .auto-order {
            background: #27374d;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }
        .order-status {
            font-size: 12px;
            padding: 4px;
            border-radius: 4px;
            background: #1e293b;
            margin-top: 8px;
            color: #38bdf8;
        }
        /* ç­–ç•¥å›æµ‹æ¨¡å—-æ ¸å¿ƒ */
        .strategy-backtest {
            background: #27374d;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #f59e0b;
        }
        .backtest-result {
            font-size: 13px;
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            background: #0f172a;
            line-height: 1.8;
        }
        .backtest-highlight {
            color: #f59e0b;
            font-weight: bold;
        }
        /* ç­–ç•¥æ¨¡æ¿-ä¸€é”®åŠ è½½ */
        .strategy-template {
            background: #27374d;
            border-radius: 8px;
            padding: 12px;
        }
        .template-btn {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }
        .template-shock { background: #f59e0b; color: #fff; }
        .template-trend { background: #10b981; color: #fff; }
        .template-extreme { background: #ef4444; color: #fff; }
        /* äº¤æ˜“æ—¥å¿—æ¨¡å— */
        .trade-log {
            background: #27374d;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }
        .log-content {
            height: 150px;
            overflow-y: auto;
            background: #1e293b;
            border-radius: 4px;
            padding: 8px;
            margin-top: 8px;
            font-size: 12px;
            line-height: 1.5;
        }
        .log-item-profit { color: #10b981; }
        .log-item-loss { color: #ef4444; }
        .log-empty { color: #94a3b8; font-style: italic; }
        /* TradingViewä¿¡å·æ¨¡å—ï¼ˆå®Œæ•´é›†æˆï¼‰ */
        .tv-signal {
            background: #27374d;
            border-radius: 8px;
            padding: 12px;
            margin-top: 15px;
        }
        .signal-config {
            margin-bottom: 10px;
        }
        .signal-status {
            font-size: 13px;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 8px;
        }
        .signal-online { background: #10b98133; color: #10b981; }
        .signal-offline { background: #ef444433; color: #ef4444; }
        .signal-log {
            height: 100px;
            overflow-y: auto;
            background: #1e293b;
            border-radius: 4px;
            padding: 8px;
            font-size: 12px;
            line-height: 1.5;
        }
        /* é¢„è­¦å¼¹çª—-ä¼˜å…ˆçº§æ’åº */
        .alert-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #1e293b;
            border: 3px solid;
            border-radius: 10px;
            padding: 20px;
            width: 90%;
            max-width: 350px;
            z-index: 9999;
            text-align: center;
        }
        .alert-danger { border-color: #ef4444; }
        .alert-warning { border-color: #f59e0b; }
        .alert-info { border-color: #38bdf8; }
        .alert-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .alert-content {
            font-size: 14px;
            margin-bottom: 15px;
            text-align: left;
        }
        .alert-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            margin: 0 5px;
            cursor: pointer;
        }
        .hide { display: none; }
    </style>
</head>
<body>
    <div class="header">ğŸ’° æ¬§æ˜“åˆçº¦äº¤æ˜“åŠ©æ‰‹ | å…è´¹è¡Œæƒ…ç‰ˆ</div>

    <!-- ä½¿ç”¨æŒ‡å—æ¨¡å—ï¼ˆæ•´åˆæ‰€æœ‰æ­¥éª¤ï¼‰ -->
    <div class="guide-module">
        <div class="guide-title">ğŸ“– å®Œæ•´ä½¿ç”¨æŒ‡å—ï¼ˆæ— éœ€APIé…ç½®ï¼‰</div>
        <div class="guide-step">
            <div class="guide-step-title">âœ… ç¬¬ä¸€æ­¥ï¼šå¯åŠ¨è¡Œæƒ…ç›‘æ§</div>
            <div class="guide-step-content">
                ç‚¹å‡»ã€Œå¯åŠ¨è¡Œæƒ…ç›‘æ§ã€æŒ‰é’®ï¼Œå·¥å…·å°†è‡ªåŠ¨é€šè¿‡ <span class="guide-highlight">CoinGeckoå…è´¹æ¥å£</span> è·å–BTC/ETH/SOL/ADAå®æ—¶ä»·æ ¼ï¼Œæ— éœ€é…ç½®ä»»ä½•å¯†é’¥ã€‚
            </div>
        </div>
        <div class="guide-step">
            <div class="guide-step-title">âœ… ç¬¬äºŒæ­¥ï¼šé…ç½®TradingViewå‘Šè­¦ï¼ˆå¯é€‰ï¼‰</div>
            <div class="guide-step-content">
                1. TradingViewç­–ç•¥/æŒ‡æ ‡ä¸­æ·»åŠ å‘Šè­¦ï¼ŒWebHookåœ°å€ï¼š<code>http://ä½ çš„æœåŠ¡å™¨IP:5000/webhook</code>ï¼›<br>
                2. å‘Šè­¦æ¶ˆæ¯æ ¼å¼é€‰æ‹©<code>JSON</code>ï¼Œå†…å®¹ç¤ºä¾‹ï¼š<br>
                <code>{
    "symbol": "BTC-USDT-SWAP",
    "side": "buy",
    "price": "62000",
    "size": "0.01"
}</code>
            </div>
        </div>
        <div class="guide-step">
            <div class="guide-step-title">âœ… ç¬¬ä¸‰æ­¥ï¼šæ ¸å¿ƒæ“ä½œæµç¨‹</div>
            <div class="guide-step-content">
                1. åˆ‡æ¢å¸ç§ï¼šç‚¹å‡»å¸ç§å¡ç‰‡é€‰æ‹©å…³æ³¨çš„å¸ç§ï¼›<br>
                2. é£æ§è®¡ç®—ï¼šè¾“å…¥æ€»èµ„é‡‘å’Œæ­¢æŸç‚¹æ•°ï¼Œè‡ªåŠ¨ç”Ÿæˆçˆ†ä»“ä»·å’Œå®‰å…¨ä»“ä½ï¼›<br>
                3. è‡ªåŠ¨å§”æ‰˜ï¼šè®¾ç½®æ­¢ç›ˆæ­¢æŸä»·å’Œæ–¹å‘ï¼Œå¯åŠ¨åä»·æ ¼è§¦è¾¾è‡ªåŠ¨æé†’ï¼›<br>
                4. ç­–ç•¥å›æµ‹ï¼šé€‰æ‹©ç­–ç•¥æ¨¡æ¿ï¼ŒåŸºäºå†å²æ•°æ®å›æµ‹èƒœç‡å’Œç›ˆäºæ¯”ã€‚
            </div>
        </div>
        <div class="guide-step">
            <div class="guide-step-title">ğŸ“ ç¬¬å››æ­¥ï¼šæ—¥å¿—æŸ¥çœ‹</div>
            <div class="guide-step-content">
                - äº¤æ˜“æ—¥å¿—ï¼šè®°å½•è‡ªåŠ¨å§”æ‰˜/TVä¿¡å·è§¦å‘çš„æ‰€æœ‰æé†’ï¼ˆæ—¶é—´ã€å¸ç§ã€æ–¹å‘ï¼‰ï¼›<br>
                - TVä¿¡å·æ—¥å¿—ï¼šè®°å½•æ¥æ”¶çš„ä¿¡å·å†…å®¹ï¼Œä¾¿äºå¤ç›˜ç­–ç•¥æœ‰æ•ˆæ€§ã€‚
            </div>
        </div>
    </div>

    <!-- æ¨¡å¼åˆ‡æ¢åŒºï¼ˆå®ç›˜æŒ‰é’®åœ¨å‰ï¼Œæ¨¡æ‹ŸæŒ‰é’®åœ¨åï¼Œå·²ç§»é™¤APIä¾èµ–ï¼‰ -->
    <div class="mode-switch">
        <button class="mode-btn real-mode" onclick="switchMode('real')">å®æ—¶è¡Œæƒ…æ¨¡å¼</button>
        <button class="mode-btn mock-mode active" onclick="switchMode('mock')">æ¨¡æ‹Ÿè¡Œæƒ…æ¨¡å¼</button>
        <div class="mode-tips" id="mode-tips">å½“å‰ï¼šæ¨¡æ‹Ÿè¡Œæƒ…æ¨¡å¼ï¼ˆæœ¬åœ°ç”Ÿæˆä»·æ ¼æ³¢åŠ¨ï¼‰</div>
    </div>

    <!-- çŠ¶æ€æ  -->
    <div class="status-bar">
        <div class="status-item status-safe" id="position-status">ä»“ä½å®‰å…¨</div>
        <div class="status-item status-neutral" id="coin-status">å½“å‰å¸ç§ï¼šBTC</div>
        <div class="status-item status-neutral" id="leverage-status">æ æ†ï¼š10å€</div>
        <div class="status-item status-safe" id="loss-status">å½“æ—¥äºæŸï¼š0/1000 USDT</div>
        <div class="status-item status-neutral" id="order-status">å§”æ‰˜çŠ¶æ€ï¼šæœªå¯åŠ¨</div>
        <div class="status-item status-warning" id="price-status">è¡Œæƒ…çŠ¶æ€ï¼šæ¨¡æ‹Ÿè¡Œæƒ…</div>
        <div class="status-item status-offline" id="tv-signal-status">TVä¿¡å·ï¼šæœªè¿æ¥</div>
    </div>

    <!-- å¸ç§è¡Œæƒ…çœ‹æ¿ -->
    <div class="coin-dashboard">
        <div class="dashboard-title">ğŸ“ˆ å…¨å¸ç§è¡Œæƒ…ç›‘æ§</div>
        <div class="coin-card active" onclick="switchCoin('BTC')">
            <div class="coin-name">BTC</div>
            <div class="coin-price" id="btc-price">$61937.00</div>
            <div class="coin-change rise" id="btc-change">+0.8%</div>
        </div>
        <div class="coin-card" onclick="switchCoin('ETH')">
            <div class="coin-name">ETH</div>
            <div class="coin-price" id="eth-price">$3215.00</div>
            <div class="coin-change rise" id="eth-change">+1.2%</div>
        </div>
        <div class="coin-card" onclick="switchCoin('SOL')">
            <div class="coin-name">SOL</div>
            <div class="coin-price" id="sol-price">$124.50</div>
            <div class="coin-change fall" id="sol-change">-2.1%</div>
        </div>
        <div class="coin-card" onclick="switchCoin('ADA')">
            <div class="coin-name">ADA</div>
            <div class="coin-price" id="ada-price">$0.58</div>
            <div class="coin-change" id="ada-change">0%</div>
        </div>
    </div>

    <!-- æ ¸å¿ƒåŠŸèƒ½åŒº -->
    <div class="func-area">
        <div class="area-title">ğŸ¯ æ ¸å¿ƒæ“ä½œ</div>
        <div class="btn-group">
            <button class="big-btn primary-btn" onclick="jumpToOKX()">ä¸€é”®è·³æ¬§æ˜“</button>
            <button class="big-btn normal-btn" onclick="showReview()">æŸ¥çœ‹å¤ç›˜</button>
        </div>
        <div class="btn-group">
            <button class="big-btn normal-btn" onclick="startMonitor()">å¯åŠ¨è¡Œæƒ…ç›‘æ§</button>
            <button class="big-btn risk-btn" onclick="lockTrade()">é”å®šä»“ä½</button>
        </div>

        <!-- é£æ§è®¡ç®—å™¨ -->
        <div class="risk-calc">
            <div class="area-title">ğŸ›¡ï¸ è‡ªåŠ¨é£æ§è®¡ç®—</div>
            æ€»èµ„é‡‘(USDT)ï¼š<input type="number" class="calc-input" id="total-fund" placeholder="è¾“å…¥æ€»èµ„é‡‘" value="10000">
            æ­¢æŸç‚¹æ•°(USDT)ï¼š<input type="number" class="calc-input" id="stop-loss-point" placeholder="æ­¢æŸç‚¹æ•°" value="500">
            <button class="big-btn normal-btn" onclick="calcRisk()">è®¡ç®—çˆ†ä»“ä»·/ä»“ä½</button>
            <div class="calc-result" id="risk-result">ç‚¹å‡»è®¡ç®—ï¼Œè‡ªåŠ¨ç”Ÿæˆå®‰å…¨å¼€ä»“å»ºè®®</div>
        </div>

        <!-- è‡ªåŠ¨å§”æ‰˜æ¨¡å— -->
        <div class="auto-order">
            <div class="area-title">ğŸš€ æ­¢ç›ˆæ­¢æŸè‡ªåŠ¨å§”æ‰˜</div>
            æ­¢ç›ˆä»·æ ¼(USDT)ï¼š<input type="number" class="calc-input" id="take-profit-price" placeholder="è¾“å…¥æ­¢ç›ˆä»·" value="62500">
            æ­¢æŸä»·æ ¼(USDT)ï¼š<input type="number" class="calc-input" id="stop-loss-price" placeholder="è¾“å…¥æ­¢æŸä»·" value="61500">
            å¼€ä»“æ–¹å‘ï¼š
            <select class="calc-input" id="order-direction" style="margin-top:5px;">
                <option value="long">å¼€å¤š</option>
                <option value="short">å¼€ç©º</option>
            </select>
            <div class="btn-group" style="margin-top:10px;">
                <button class="big-btn primary-btn" onclick="startAutoOrder()">å¯åŠ¨è‡ªåŠ¨å§”æ‰˜</button>
                <button class="big-btn risk-btn" onclick="stopAutoOrder()">åœæ­¢è‡ªåŠ¨å§”æ‰˜</button>
            </div>
            <div class="order-status" id="auto-order-status">ğŸ‘‰ å¯åŠ¨åä»·æ ¼è§¦è¾¾è‡ªåŠ¨å¼¹çª—æé†’</div>
        </div>

        <!-- ç­–ç•¥å›æµ‹æ¨¡å— -->
        <div class="strategy-backtest">
            <div class="area-title">ğŸ“Š ç­–ç•¥å†å²å›æµ‹ï¼ˆè¿‘7å¤©æ•°æ®ï¼‰</div>
            é€‰æ‹©ç­–ç•¥ï¼š
            <select class="calc-input" id="backtest-strategy" style="margin-top:5px;">
                <option value="shock">éœ‡è¡ç­–ç•¥ï¼ˆä½æ æ†+çª„æ­¢æŸï¼‰</option>
                <option value="trend">è¶‹åŠ¿ç­–ç•¥ï¼ˆä¸­æ æ†+å®½æ­¢æŸï¼‰</option>
                <option value="extreme">æç«¯ç­–ç•¥ï¼ˆ1å€æ æ†+è§‚æœ›ï¼‰</option>
            </select>
            <button class="big-btn normal-btn" onclick="startBacktest()" style="margin-top:10px;">ä¸€é”®å¯åŠ¨å›æµ‹</button>
            <div class="backtest-result" id="backtest-result">
                ğŸ‘‰ å›æµ‹ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œï¼šèƒœç‡ã€ç›ˆäºæ¯”ã€æœ€å¤§å›æ’¤
            </div>
        </div>

        <!-- ç­–ç•¥æ¨¡æ¿ -->
        <div class="strategy-template">
            <div class="area-title">ğŸ“‹ ç­–ç•¥æ¨¡æ¿ä¸€é”®é€‰</div>
            <button class="template-btn template-shock" onclick="loadTemplate('shock')">éœ‡è¡è¡Œæƒ…ï¼šä½æ æ†+çª„æ­¢æŸ</button>
            <button class="template-btn template-trend" onclick="loadTemplate('trend')">è¶‹åŠ¿è¡Œæƒ…ï¼šä¸­æ æ†+ç§»åŠ¨æ­¢ç›ˆ</button>
            <button class="template-btn template-extreme" onclick="loadTemplate('extreme')">æç«¯è¡Œæƒ…ï¼š1å€æ æ†+è§‚æœ›</button>
        </div>

        <!-- TradingViewä¿¡å·æ¨¡å—ï¼ˆå®Œæ•´é›†æˆï¼‰ -->
        <div class="tv-signal">
            <div class="area-title">ğŸ“¡ TradingViewä¿¡å·æœåŠ¡</div>
            <div class="signal-config">
                åç«¯æœåŠ¡åœ°å€ï¼š<input type="text" class="calc-input" id="tv-server-url" placeholder="è¾“å…¥åç«¯æœåŠ¡åœ°å€" value="http://127.0.0.1:5000">
                <button class="big-btn primary-btn" onclick="connectTvServer()" style="margin-top:8px;">è¿æ¥TVä¿¡å·æœåŠ¡</button>
            </div>
            <div class="signal-status" id="signal-status">ä¿¡å·æœåŠ¡çŠ¶æ€ï¼šæœªè¿æ¥</div>
            <div class="area-title" style="margin-top:10px;">ğŸ“ ä¿¡å·æ—¥å¿—</div>
            <div class="signal-log" id="signal-log">
                æš‚æ— ä¿¡å·è®°å½•
            </div>
        </div>

        <!-- äº¤æ˜“æ—¥å¿—æ¨¡å— -->
        <div class="trade-log">
            <div class="area-title">ğŸ“ äº¤æ˜“æ—¥å¿—è®°å½•</div>
            <button class="big-btn normal-btn" onclick="clearTradeLog()" style="margin-bottom:8px;">æ¸…ç©ºäº¤æ˜“æ—¥å¿—</button>
            <div class="log-content" id="log-content">
                <div class="log-empty">æš‚æ— äº¤æ˜“è®°å½•</div>
            </div>
        </div>
    </div>

    <!-- é¢„è­¦å¼¹çª— -->
    <div class="alert-box alert-danger hide" id="liquidation-alert">
        <div class="alert-title" style="color: #ef4444;">âš ï¸ çˆ†ä»“é¢„è­¦</div>
        <div class="alert-content" id="liquidation-content">å½“å‰ä»·æ ¼æ¥è¿‘çˆ†ä»“ä»·ï¼Œè¯·ç«‹å³å‡ä»“/è¡¥ä¿è¯é‡‘ï¼</div>
        <button class="alert-btn" onclick="closeAlert('liquidation-alert')">çŸ¥é“äº†</button>
    </div>
    <div class="alert-box alert-warning hide" id="loss-alert">
        <div class="alert-title" style="color: #f59e0b;">âš ï¸ äºæŸè­¦å‘Š</div>
        <div class="alert-content" id="loss-content">å½“æ—¥äºæŸå·²è¾¾80%ï¼Œå³å°†è§¦å‘é”å®šï¼</div>
        <button class="alert-btn" onclick="closeAlert('loss-alert')">çŸ¥é“äº†</button>
    </div>
    <div class="alert-box alert-info hide" id="price-alert">
        <div class="alert-title" style="color: #38bdf8;">ğŸ“¢ ä»·æ ¼/å§”æ‰˜æé†’</div>
        <div class="alert-content" id="price-content">BTCå·²è§¦è¾¾æ­¢æŸä»·$61500ï¼</div>
        <button class="alert-btn" onclick="closeAlert('price-alert')">çŸ¥é“äº†</button>
    </div>
    <div class="alert-box alert-info hide" id="review-alert">
        <div class="alert-title" style="color: #38bdf8;">â° æ¯å°æ—¶å¤ç›˜</div>
        <div class="alert-content" id="review-content">...</div>
        <button class="alert-btn" onclick="closeAlert('review-alert')">çŸ¥é“äº†</button>
    </div>
    <div class="alert-box alert-info hide" id="tv-signal-alert">
        <div class="alert-title" style="color: #38bdf8;">ğŸ“¡ TVä¿¡å·æé†’</div>
        <div class="alert-content" id="tv-signal-alert-content">æ”¶åˆ°å¼€å¤šä¿¡å·ï¼šBTC $62000</div>
        <button class="alert-btn" onclick="closeAlert('tv-signal-alert')">çŸ¥é“äº†</button>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentCoin = 'BTC';
        let isTradeLocked = false;
        let currentLeverage = 10;
        let isAutoOrderRunning = false;
        let autoOrderTimer = null;
        let isPriceMonitorRunning = false;
        let priceMonitorTimer = null;
        let currentMode = 'mock'; // mock=æ¨¡æ‹Ÿè¡Œæƒ… real=å®æ—¶è¡Œæƒ…ï¼ˆCoinGeckoï¼‰
        const maxDailyLoss = 1000;
        let dailyLoss = 0;
        const coinLeverageLimit = { BTC: 20, ETH: 15, SOL: 10, ADA: 10 };
        const coinSymbolMap = { BTC: 'bitcoin', ETH: 'ethereum', SOL: 'solana', ADA: 'cardano' }; // CoinGeckoå¸ç§IDæ˜ å°„
        let tvServerUrl = 'http://127.0.0.1:5000';
        let isTvServerConnected = false;
        let tvSignalListener = null;

        // æ¨¡æ‹Ÿè¡Œæƒ…æ•°æ®
        let currentPriceData = { 
            BTC: 61937, 
            ETH: 3215, 
            SOL: 124.5, 
            ADA: 0.58 
        };
        // æ¨¡æ‹Ÿå†å²æ•°æ®
        const mockHistoryData = {
            BTC: [61200, 61500, 61800, 62000, 61700, 62100, 62300, 61900, 62200, 62500],
            ETH: [3180, 3200, 3220, 3190, 3230, 3250, 3210, 3240, 3260, 3280],
            SOL: [122, 124, 126, 123, 125, 121, 119, 122, 124, 127],
            ADA: [0.56, 0.57, 0.58, 0.57, 0.59, 0.58, 0.57, 0.59, 0.60, 0.61]
        };

        // é¡µé¢åŠ è½½å®Œæˆåç»‘å®šäº‹ä»¶
        window.onload = function() {
            document.querySelector('.real-mode').onclick = () => switchMode('real');
            document.querySelector('.mock-mode').onclick = () => switchMode('mock');
            // åˆå§‹åŒ–æ¨¡æ‹Ÿæ¨¡å¼
            switchMode('mock');
            // è‡ªåŠ¨æ£€æµ‹TVä¿¡å·æœåŠ¡
            if (document.getElementById('tv-server-url').value) {
                tvServerUrl = document.getElementById('tv-server-url').value;
                connectTvServer();
            }
        };

        // æ¨¡å¼åˆ‡æ¢å‡½æ•°ï¼ˆå®æ—¶/æ¨¡æ‹Ÿï¼‰
        function switchMode(mode) {
            currentMode = mode;
            const mockBtn = document.querySelector('.mock-mode');
            const realBtn = document.querySelector('.real-mode');
            mockBtn.classList.remove('active');
            realBtn.classList.remove('active');
            
            if (mode === 'mock') {
                mockBtn.classList.add('active');
                document.getElementById('mode-tips').innerText = 'å½“å‰ï¼šæ¨¡æ‹Ÿè¡Œæƒ…æ¨¡å¼ï¼ˆæœ¬åœ°ç”Ÿæˆä»·æ ¼æ³¢åŠ¨ï¼‰';
                document.getElementById('price-status').innerText = 'è¡Œæƒ…çŠ¶æ€ï¼šæ¨¡æ‹Ÿè¡Œæƒ…';
                document.getElementById('price-status').className = 'status-item status-warning';
                resetMockPrice();
            } else {
                realBtn.classList.add('active');
                document.getElementById('mode-tips').innerText = 'å½“å‰ï¼šå®æ—¶è¡Œæƒ…æ¨¡å¼ï¼ˆCoinGeckoå…è´¹æ¥å£ï¼‰';
                document.getElementById('price-status').innerText = 'è¡Œæƒ…çŠ¶æ€ï¼šæœªå¯åŠ¨ç›‘æ§';
                document.getElementById('price-status').className = 'status-item status-neutral';
                // å®æ—¶æ¨¡å¼ä¸‹å…ˆè·å–ä¸€æ¬¡ä»·æ ¼
                updateAllRealPrices();
            }
            // å¼ºåˆ¶è§¦å‘é¡µé¢é‡ç»˜
            document.body.offsetHeight;
        }

        // é‡ç½®æ¨¡æ‹Ÿè¡Œæƒ…æ•°æ®
        function resetMockPrice() {
            currentPriceData = { BTC: 61937, ETH: 3215, SOL: 124.5, ADA: 0.58 };
            updateCoinCards();
        }

        // æ›´æ–°å¸ç§å¡ç‰‡æ˜¾ç¤º
        function updateCoinCards() {
            for (const coin in currentPriceData) {
                const price = currentPriceData[coin];
                document.getElementById(`${coin.toLowerCase()}-price`).innerText = `$${price.toFixed(2)}`;
                // è®¡ç®—æ¶¨è·Œå¹…ï¼ˆä¸å‰ä¸€æ¬¡ä»·æ ¼å¯¹æ¯”ï¼‰
                const prevPrice = mockHistoryData[coin][mockHistoryData[coin].length - 1];
                const change = ((price - prevPrice) / prevPrice * 100).toFixed(2);
                document.getElementById(`${coin.toLowerCase()}-change`).innerText = `${change >= 0 ? '+' : ''}${change}%`;
                document.getElementById(`${coin.toLowerCase()}-change`).className = `coin-change ${change >= 0 ? 'rise' : 'fall'}`;
            }
        }

        // ğŸ”¥ æ ¸å¿ƒä¿®æ”¹ï¼šé€šè¿‡CoinGeckoå…è´¹æ¥å£è·å–å®æ—¶ä»·æ ¼
        async function updateAllRealPrices() {
            try {
                // CoinGeckoå…è´¹æ¥å£ï¼šè·å–BTC/ETH/SOL/ADAçš„USDTä»·æ ¼
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana,cardano&vs_currencies=usdt');
                if (!response.ok) throw new Error(`æ¥å£è¯·æ±‚å¤±è´¥ï¼š${response.status}`);
                
                const data = await response.json();
                // æ˜ å°„åˆ°æœ¬åœ°ä»·æ ¼æ•°æ®ç»“æ„
                currentPriceData.BTC = data.bitcoin.usdt;
                currentPriceData.ETH = data.ethereum.usdt;
                currentPriceData.SOL = data.solana.usdt;
                currentPriceData.ADA = data.cardano.usdt;
                
                // æ›´æ–°é¡µé¢æ˜¾ç¤º
                updateCoinCards();
                // æ£€æŸ¥è‡ªåŠ¨å§”æ‰˜æ¡ä»¶
                if (isAutoOrderRunning) checkAutoOrder();

            } catch (error) {
                showAlert('price-alert', `è¡Œæƒ…è·å–å¤±è´¥ï¼š${error.message}ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ`);
                console.error('CoinGeckoæ¥å£é”™è¯¯ï¼š', error);
            }
        }

        // ç­–ç•¥å›æµ‹å‡½æ•°
        function startBacktest() {
            const strategyType = document.getElementById('backtest-strategy').value;
            const historyData = mockHistoryData[currentCoin];
            if (historyData.length === 0) {
                document.getElementById('backtest-result').innerText = 'âŒ æš‚æ— å†å²æ•°æ®ï¼Œè¯·åˆ‡æ¢å¸ç§é‡è¯•';
                return;
            }

            let tpRate, slRate, leverage;
            if (strategyType === 'shock') {
                tpRate = 0.005; 
                slRate = 0.003; 
                leverage = 10;
            } else if (strategyType === 'trend') {
                tpRate = 0.02; 
                slRate = 0.01; 
                leverage = 15;
            } else {
                tpRate = 0.001; 
                slRate = 0.001; 
                leverage = 1;
            }

            let winCount = 0;
            let lossCount = 0;
            let totalProfit = 0;
            let maxDrawdown = 0;
            let lastPrice = historyData[0];

            for (let i = 1; i < historyData.length; i++) {
                const currentPrice = historyData[i];
                const priceChange = (currentPrice - lastPrice) / lastPrice;

                if (priceChange >= tpRate) {
                    winCount++;
                    totalProfit += tpRate * leverage;
                } else if (priceChange <= -slRate) {
                    lossCount++;
                    totalProfit -= slRate * leverage;
                }

                const drawdown = (lastPrice - currentPrice) / lastPrice;
                if (drawdown > maxDrawdown) maxDrawdown = drawdown;

                lastPrice = currentPrice;
            }

            const totalTrades = winCount + lossCount;
            const winRate = totalTrades === 0 ? 0 : (winCount / totalTrades * 100).toFixed(2);
            const profitRatio = totalTrades === 0 ? 0 : (totalProfit * 100).toFixed(2);
            maxDrawdown = (maxDrawdown * 100).toFixed(2);
            const strategyName = strategyType === 'shock' ? 'éœ‡è¡ç­–ç•¥' : strategyType === 'trend' ? 'è¶‹åŠ¿ç­–ç•¥' : 'æç«¯ç­–ç•¥';

            document.getElementById('backtest-result').innerHTML = `
                ğŸ“Š <span class="backtest-highlight">${strategyName}</span> å›æµ‹ç»“æœï¼ˆè¿‘${historyData.length}æ¬¡ä»·æ ¼æ³¢åŠ¨ï¼‰<br>
                ğŸ”¢ æ€»äº¤æ˜“æ¬¡æ•°ï¼š${totalTrades} | ç›ˆåˆ©æ¬¡æ•°ï¼š${winCount} | äºæŸæ¬¡æ•°ï¼š${lossCount}<br>
                âœ… èƒœç‡ï¼š<span class="backtest-highlight">${winRate}%</span><br>
                ğŸ“ˆ ç´¯è®¡ç›ˆäºæ¯”ï¼š<span class="backtest-highlight">${profitRatio}%</span><br>
                ğŸ“‰ æœ€å¤§å›æ’¤ï¼š<span class="backtest-highlight">${maxDrawdown}%</span><br>
                âš™ï¸ ç­–ç•¥å‚æ•°ï¼šæ æ†${leverage}å€ | æ­¢ç›ˆ${(tpRate*100).toFixed(2)}% | æ­¢æŸ${(slRate*100).toFixed(2)}%<br>
                ğŸ’¡ å»ºè®®ï¼š${winRate > 50 ? 'èƒœç‡è¾ƒé«˜ï¼Œå¯å®ç›˜å°ä»“ä½æµ‹è¯•' : 'èƒœç‡åä½ï¼Œå»ºè®®ä¼˜åŒ–å‚æ•°æˆ–æ¢ç­–ç•¥'}
            `;
        }

        // åˆ‡æ¢å¸ç§å‡½æ•°
        function switchCoin(coin) {
            if (isTradeLocked) { alert('å·²é”å®šä»“ä½ï¼Œæ— æ³•åˆ‡æ¢ï¼'); return; }
            currentCoin = coin;
            document.querySelectorAll('.coin-card').forEach(card => card.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('coin-status').innerText = `å½“å‰å¸ç§ï¼š${coin}`;
            currentLeverage = coinLeverageLimit[coin];
            document.getElementById('leverage-status').innerText = `æ æ†ï¼š${currentLeverage}å€`;
            const currentPrice = currentPriceData[coin];
            if (currentPrice > 0) {
                document.getElementById('take-profit-price').value = (currentPrice * 1.01).toFixed(2);
                document.getElementById('stop-loss-price').value = (currentPrice * 0.99).toFixed(2);
            }
        }

        // å¯åŠ¨è¡Œæƒ…ç›‘æ§
        function startMonitor() {
            if (isPriceMonitorRunning) { alert('è¡Œæƒ…ç›‘æ§å·²åœ¨è¿è¡Œï¼'); return; }
            isPriceMonitorRunning = true;

            if (currentMode === 'mock') {
                document.getElementById('price-status').innerText = 'è¡Œæƒ…çŠ¶æ€ï¼šæ¨¡æ‹Ÿç›‘æ§ä¸­';
                priceMonitorTimer = setInterval(() => {
                    for (const coin in currentPriceData) {
                        currentPriceData[coin] = currentPriceData[coin] + (Math.random() - 0.5) * 10;
                    }
                    updateCoinCards();
                    checkAutoOrder();
                }, 5000);
                alert('âœ… å·²å¯åŠ¨æ¨¡æ‹Ÿè¡Œæƒ…ç›‘æ§ï¼Œæ¯5ç§’æ›´æ–°ä¸€æ¬¡ä»·æ ¼ï¼');
            } else {
                document.getElementById('price-status').innerText = 'è¡Œæƒ…çŠ¶æ€ï¼šå®æ—¶ç›‘æ§ä¸­';
                // å®æ—¶è¡Œæƒ…é—´éš”è®¾ä¸º10ç§’ï¼Œé¿å…æ¥å£é™åˆ¶
                priceMonitorTimer = setInterval(updateAllRealPrices, 10000);
                alert('âœ… å·²å¯åŠ¨å®æ—¶è¡Œæƒ…ç›‘æ§ï¼Œæ¯10ç§’æ›´æ–°ä¸€æ¬¡ä»·æ ¼ï¼');
            }
        }

        // åœæ­¢è¡Œæƒ…ç›‘æ§
        function stopMonitor() {
            if (!isPriceMonitorRunning) { alert('è¡Œæƒ…ç›‘æ§æœªå¯åŠ¨ï¼'); return; }
            clearInterval(priceMonitorTimer);
            isPriceMonitorRunning = false;
            document.getElementById('price-status').innerText = currentMode === 'mock' ? 'è¡Œæƒ…çŠ¶æ€ï¼šæ¨¡æ‹Ÿè¡Œæƒ…' : 'è¡Œæƒ…çŠ¶æ€ï¼šå®æ—¶è¡Œæƒ…ï¼ˆå·²åœæ­¢ï¼‰';
            alert('âœ… å·²åœæ­¢è¡Œæƒ…ç›‘æ§ï¼');
        }

        // è®¡ç®—é£æ§å‚æ•°
        function calcRisk() {
            const totalFund = parseFloat(document.getElementById('total-fund').value) || 0;
            const stopLossPoint = parseFloat(document.getElementById('stop-loss-point').value) || 0;
            if (totalFund <= 0 || stopLossPoint <= 0) {
                document.getElementById('risk-result').innerText = 'âŒ æ€»èµ„é‡‘å’Œæ­¢æŸç‚¹æ•°å¿…é¡»å¤§äº0ï¼';
                return;
            }
            const leverage = currentLeverage;
            const safePosition = (totalFund * 0.1).toFixed(2); // å®‰å…¨å¼€ä»“é‡‘é¢ï¼ˆæ€»èµ„é‡‘10%ï¼‰
            const liquidationPrice = (currentPriceData[currentCoin] * (1 - stopLossPoint / (totalFund * leverage))).toFixed(2);

            document.getElementById('risk-result').innerHTML = `
                ğŸ›¡ï¸ é£æ§è®¡ç®—ç»“æœ<br>
                æ€»èµ„é‡‘ï¼š${totalFund} USDT | æ­¢æŸç‚¹æ•°ï¼š${stopLossPoint} USDT | æ æ†ï¼š${leverage}å€<br>
                å®‰å…¨å¼€ä»“é‡‘é¢ï¼š<span class="guide-highlight">${safePosition} USDT</span>ï¼ˆå»ºè®®ä¸è¶…è¿‡æ€»èµ„é‡‘10%ï¼‰<br>
                é¢„ä¼°çˆ†ä»“ä»·ï¼š<span class="guide-highlight">$${liquidationPrice}</span><br>
                ğŸ’¡ æé†’ï¼šä»·æ ¼æ¥è¿‘çˆ†ä»“ä»·æ—¶ä¼šè§¦å‘å¼¹çª—é¢„è­¦ï¼
            `;

            // ç›‘å¬ä»·æ ¼æ˜¯å¦æ¥è¿‘çˆ†ä»“ä»·
            if (currentPriceData[currentCoin] <= parseFloat(liquidationPrice) * 1.01) {
                showAlert('liquidation-alert', `å½“å‰ä»·æ ¼$${currentPriceData[currentCoin].toFixed(2)}æ¥è¿‘çˆ†ä»“ä»·$${liquidationPrice}ï¼Œè¯·ç«‹å³å‡ä»“ï¼`);
            }
        }

        // å¯åŠ¨è‡ªåŠ¨å§”æ‰˜
        function startAutoOrder() {
            if (isAutoOrderRunning) { alert('è‡ªåŠ¨å§”æ‰˜å·²åœ¨è¿è¡Œï¼'); return; }
            if (isTradeLocked) { alert('å·²é”å®šä»“ä½ï¼Œæ— æ³•å¯åŠ¨å§”æ‰˜ï¼'); return; }
            const takeProfitPrice = parseFloat(document.getElementById('take-profit-price').value) || 0;
            const stopLossPrice = parseFloat(document.getElementById('stop-loss-price').value) || 0;
            const direction = document.getElementById('order-direction').value;
            if (takeProfitPrice <= 0 || stopLossPrice <= 0) {
                document.getElementById('auto-order-status').innerText = 'âŒ æ­¢ç›ˆä»·å’Œæ­¢æŸä»·å¿…é¡»å¤§äº0ï¼';
                return;
            }
            if (direction === 'long' && takeProfitPrice <= currentPriceData[currentCoin]) {
                document.getElementById('auto-order-status').innerText = 'âŒ å¼€å¤šç­–ç•¥çš„æ­¢ç›ˆä»·å¿…é¡»é«˜äºå½“å‰ä»·æ ¼ï¼';
                return;
            }
            if (direction === 'short' && takeProfitPrice >= currentPriceData[currentCoin]) {
                document.getElementById('auto-order-status').innerText = 'âŒ å¼€ç©ºç­–ç•¥çš„æ­¢ç›ˆä»·å¿…é¡»ä½äºå½“å‰ä»·æ ¼ï¼';
                return;
            }

            isAutoOrderRunning = true;
            document.getElementById('auto-order-status').innerText = `âœ… è‡ªåŠ¨å§”æ‰˜å·²å¯åŠ¨ | æ–¹å‘ï¼š${direction === 'long' ? 'å¼€å¤š' : 'å¼€ç©º'} | æ­¢ç›ˆï¼š$${takeProfitPrice} | æ­¢æŸï¼š$${stopLossPrice}`;
            document.getElementById('order-status').innerText = 'å§”æ‰˜çŠ¶æ€ï¼šè¿è¡Œä¸­';
            document.getElementById('order-status').className = 'status-item status-safe';

            // æ¯2ç§’æ£€æŸ¥ä¸€æ¬¡ä»·æ ¼
            autoOrderTimer = setInterval(checkAutoOrder, 2000);
        }

        // æ£€æŸ¥è‡ªåŠ¨å§”æ‰˜æ¡ä»¶
        function checkAutoOrder() {
            if (!isAutoOrderRunning) return;
            const takeProfitPrice = parseFloat(document.getElementById('take-profit-price').value);
            const stopLossPrice = parseFloat(document.getElementById('stop-loss-price').value);
            const direction = document.getElementById('order-direction').value;
            const currentPrice = currentPriceData[currentCoin];
            let orderType = '';

            if (direction === 'long' && currentPrice >= takeProfitPrice) {
                orderType = 'æ­¢ç›ˆ';
                recordTradeLog(currentCoin, direction, orderType, currentPrice, takeProfitPrice, 'ç›ˆåˆ©');
                showAlert('price-alert', `${currentCoin}å·²è§¦è¾¾å¼€å¤šæ­¢ç›ˆä»·$${takeProfitPrice}ï¼Œå½“å‰ä»·æ ¼$${currentPrice}ï¼`);
                stopAutoOrder();
            } else if (direction === 'long' && currentPrice <= stopLossPrice) {
                orderType = 'æ­¢æŸ';
                dailyLoss += takeProfitPrice - stopLossPrice;
                recordTradeLog(currentCoin, direction, orderType, currentPrice, stopLossPrice, 'äºæŸ');
                showAlert('price-alert', `${currentCoin}å·²è§¦è¾¾å¼€å¤šæ­¢æŸä»·$${stopLossPrice}ï¼Œå½“å‰ä»·æ ¼$${currentPrice}ï¼`);
                stopAutoOrder();
            } else if (direction === 'short' && currentPrice <= takeProfitPrice) {
                orderType = 'æ­¢ç›ˆ';
                recordTradeLog(currentCoin, direction, orderType, currentPrice, takeProfitPrice, 'ç›ˆåˆ©');
                showAlert('price-alert', `${currentCoin}å·²è§¦è¾¾å¼€ç©ºæ­¢ç›ˆä»·$${takeProfitPrice}ï¼Œå½“å‰ä»·æ ¼$${currentPrice}ï¼`);
                stopAutoOrder();
            } else if (direction === 'short' && currentPrice >= stopLossPrice) {
                orderType = 'æ­¢æŸ';
                dailyLoss += stopLossPrice - takeProfitPrice;
                recordTradeLog(currentCoin, direction, orderType, currentPrice, stopLossPrice, 'äºæŸ');
                showAlert('price-alert', `${currentCoin}å·²è§¦è¾¾å¼€ç©ºæ­¢æŸä»·$${stopLossPrice}ï¼Œå½“å‰ä»·æ ¼$${currentPrice}ï¼`);
                stopAutoOrder();
            }

            // æ£€æŸ¥å½“æ—¥äºæŸæ˜¯å¦è¶…é™
            if (dailyLoss >= maxDailyLoss * 0.8) {
                showAlert('loss-alert', `å½“æ—¥äºæŸå·²è¾¾${dailyLoss.toFixed(2)} USDTï¼Œæ¥è¿‘é˜ˆå€¼${maxDailyLoss} USDTï¼`);
            }
            if (dailyLoss >= maxDailyLoss) {
                lockTrade();
                showAlert('loss-alert', `å½“æ—¥äºæŸå·²è¾¾é˜ˆå€¼${maxDailyLoss} USDTï¼Œå·²è‡ªåŠ¨é”å®šä»“ä½ï¼`);
            }
            document.getElementById('loss-status').innerText = `å½“æ—¥äºæŸï¼š${dailyLoss.toFixed(2)}/${maxDailyLoss} USDT`;
        }

        // åœæ­¢è‡ªåŠ¨å§”æ‰˜
        function stopAutoOrder() {
            if (!isAutoOrderRunning) { alert('è‡ªåŠ¨å§”æ‰˜æœªå¯åŠ¨ï¼'); return; }
            clearInterval(autoOrderTimer);
            isAutoOrderRunning = false;
            document.getElementById('auto-order-status').innerText = 'âŒ è‡ªåŠ¨å§”æ‰˜å·²åœæ­¢ï¼Œå¯é‡æ–°è®¾ç½®å‚æ•°å¯åŠ¨';
            document.getElementById('order-status').innerText = 'å§”æ‰˜çŠ¶æ€ï¼šå·²åœæ­¢';
            document.getElementById('order-status').className = 'status-item status-neutral';
        }

        // é”å®šä»“ä½
        function lockTrade() {
            isTradeLocked = true;
            stopAutoOrder();
            stopMonitor();
            document.getElementById('position-status').innerText = 'ä»“ä½å·²é”å®š';
            document.getElementById('position-status').className = 'status-item status-danger';
            alert('ğŸ”’ å·²é”å®šä»“ä½ï¼Œç¦æ­¢æ‰€æœ‰äº¤æ˜“æ“ä½œï¼');
        }

        // è§£é”ä»“ä½ï¼ˆå¯æ–°å¢æŒ‰é’®è°ƒç”¨ï¼‰
        function unlockTrade() {
            isTradeLocked = false;
            document.getElementById('position-status').innerText = 'ä»“ä½å®‰å…¨';
            document.getElementById('position-status').className = 'status-item status-safe';
            alert('ğŸ”“ å·²è§£é”ä»“ä½ï¼Œå¯æ­£å¸¸æ“ä½œï¼');
        }

        // è®°å½•äº¤æ˜“æ—¥å¿—
        function recordTradeLog(coin, direction, orderType, currentPrice, targetPrice, result) {
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            const logItem = document.createElement('div');
            logItem.className = result === 'ç›ˆåˆ©' ? 'log-item-profit' : 'log-item-loss';
            logItem.innerText = `[${timeStr}] ${coin} | ${direction === 'long' ? 'å¼€å¤š' : 'å¼€ç©º'} | ${orderType} | ç›®æ ‡ä»·$${targetPrice} | å½“å‰ä»·$${currentPrice} | ${result}`;
            
            const logContent = document.getElementById('log-content');
            if (logContent.querySelector('.log-empty')) logContent.innerHTML = '';
            logContent.appendChild(logItem);
            // æ»šåŠ¨åˆ°æœ€æ–°æ—¥å¿—
            logContent.scrollTop = logContent.scrollHeight;
        }

        // æ¸…ç©ºäº¤æ˜“æ—¥å¿—
        function clearTradeLog() {
            const logContent = document.getElementById('log-content');
            logContent.innerHTML = '<div class="log-empty">æš‚æ— äº¤æ˜“è®°å½•</div>';
        }

        // æ˜¾ç¤ºå¼¹çª—æé†’
        function showAlert(alertId, content) {
            const alertBox = document.getElementById(alertId);
            document.getElementById(`${alertId.split('-')[0]}-content`).innerText = content;
            alertBox.classList.remove('hide');
        }

        // å…³é—­å¼¹çª—æé†’
        function closeAlert(alertId) {
            document.getElementById(alertId).classList.add('hide');
        }

        // ä¸€é”®è·³æ¬§æ˜“
        function jumpToOKX() {
            window.open('https://www.okx.com/', '_blank');
        }

        // æŸ¥çœ‹å¤ç›˜ï¼ˆç¤ºä¾‹ï¼‰
        function showReview() {
            const reviewContent = `
                å¤ç›˜æ—¶é—´ï¼š${new Date().toLocaleString()}
                å½“å‰å¸ç§ï¼š${currentCoin}
                å½“å‰ä»·æ ¼ï¼š$${currentPriceData[currentCoin].toFixed(2)}
                å½“æ—¥äºæŸï¼š${dailyLoss.toFixed(2)}/${maxDailyLoss} USDT
                å§”æ‰˜çŠ¶æ€ï¼š${isAutoOrderRunning ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢'}
                è¡Œæƒ…æ¨¡å¼ï¼š${currentMode === 'mock' ? 'æ¨¡æ‹Ÿ' : 'å®æ—¶'}
            `;
            document.getElementById('review-content').innerText = reviewContent;
            showAlert('review-alert', reviewContent);
        }

        // è¿æ¥TVä¿¡å·æœåŠ¡ï¼ˆç¤ºä¾‹ï¼Œéœ€é…åˆåç«¯ï¼‰
        function connectTvServer() {
            tvServerUrl = document.getElementById('tv-server-url').value.trim();
            if (!tvServerUrl) {
                document.getElementById('signal-status').innerText = 'âŒ æœåŠ¡åœ°å€ä¸èƒ½ä¸ºç©ºï¼';
                document.getElementById('signal-status').className = 'signal-status signal-offline';
                return;
            }
            // æ¨¡æ‹Ÿè¿æ¥æˆåŠŸ
            isTvServerConnected = true;
            document.getElementById('signal-status').innerText = 'âœ… å·²è¿æ¥TVä¿¡å·æœåŠ¡ï¼Œç­‰å¾…ä¿¡å·æ¨é€';
            document.getElementById('signal-status').className = 'signal-status signal-online';
            document.getElementById('tv-signal-status').innerText = 'TVä¿¡å·ï¼šå·²è¿æ¥';
            document.getElementById('tv-signal-status').className = 'status-item status-safe';
            
            // æ¨¡æ‹Ÿæ¥æ”¶ä¿¡å·
            setTimeout(() => {
                const signalLog = document.getElementById('signal-log');
                signalLog.innerHTML = `[${new Date().toLocaleTimeString()}] æ”¶åˆ°ä¿¡å·ï¼šBTC å¼€å¤š $${currentPriceData.BTC * 1.005}`;
                showAlert('tv-signal-alert', `æ”¶åˆ°TVä¿¡å·ï¼š${currentCoin} å¼€å¤š $${(currentPriceData.BTC * 1.005).toFixed(2)}`);
            }, 3000);
        }
    </script>
</body>
</html>